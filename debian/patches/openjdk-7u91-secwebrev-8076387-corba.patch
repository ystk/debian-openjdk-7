# HG changeset patch
# User msheppar
# Date 1436893390 -3600
#      Tue Jul 14 18:03:10 2015 +0100
# Node ID 05084f644c07a81e2b246db38917df253f5e2882
# Parent  d185c856ef85de2f9ee2c318d3084869e6f2a836
8076387: Better CORBA value handling
Reviewed-by: rriggs, coffeys, skoivu, ahgross

Index: openjdk/corba/src/share/classes/com/sun/corba/se/impl/io/IIOPInputStream.java
===================================================================
--- openjdk/corba/src/share/classes/com/sun/corba/se/impl/io/IIOPInputStream.java.orig
+++ openjdk/corba/src/share/classes/com/sun/corba/se/impl/io/IIOPInputStream.java
@@ -1063,6 +1063,9 @@ public class IIOPInputStream
 
             int spBase = spClass;       // current top of stack
 
+            if (currentClass.getName().equals("java.lang.String")) {
+                return this.readUTF();
+            }
             /* The object's classes should be processed from supertype to subtype
              * Push all the clases of the current object onto a stack.
              * Note that only the serializable classes are represented
Index: openjdk/corba/src/share/classes/com/sun/corba/se/impl/io/IIOPOutputStream.java
===================================================================
--- openjdk/corba/src/share/classes/com/sun/corba/se/impl/io/IIOPOutputStream.java.orig
+++ openjdk/corba/src/share/classes/com/sun/corba/se/impl/io/IIOPOutputStream.java
@@ -559,6 +559,10 @@ public class IIOPOutputStream
              * Push all the clases of the current object onto a stack.
              * Remember the stack pointer where this set of classes is being pushed.
              */
+            if (currentClassDesc.forClass().getName().equals("java.lang.String")) {
+                    this.writeUTF((String)obj);
+                    return;
+            }
             int stackMark = classDescStack.size();
             try {
                 ObjectStreamClass next;
